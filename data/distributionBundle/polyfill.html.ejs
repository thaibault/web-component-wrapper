<!--
    Promise: React uses for rendering.

    NOTE: "Array.from", "Object.assign" and "Promise" will be polyfilled by the
    webcomponent polyfill.
-->
<%_
    const features = new Set([
        // Most polyfills are determined via "create-polyfill-service-url".
        'Array.from',
        'Array.isArray',
        'Array.prototype.entries',
        'Array.prototype.filter',
        // Is used by "Object.entries" polyfill.
        'Array.prototype.flat',
        // clientnode - Usage.
        'Array.prototype.includes',
        'Array.prototype.keys',
        'Array.prototype.map',
        'Array.prototype.values',
        // Usual array interaction.
        'Array.prototype.@@iterator',
        'ArrayBuffer',
        'console',
        'CustomEvent',
        'DataView',
        'document',
        // Usual dom interactions.
        'DOMTokenList.prototype.@@iterator',
        'Function.prototype.bind',
        'JSON',
        'Map',
        // Usual dom interactions.
        'NodeList.prototype.@@iterator',
        'Object.defineProperty',
        // Iterating over mapping objects everywhere.
        'Object.entries',
        // Applying a scope object during template function call.
        'Object.keys',
        'Object.values',
        'Promise',
        'Set',
        // Many usages e.g. in clientnode.
        'String.prototype.endsWith',
        'String.prototype.includes',
        'String.prototype.startsWith',
        'String.prototype.trim',
        // Used by react to identify its own entities.
        'Symbol',
        'Symbol.for',
        'Symbol.iterator',
        'Symbol.toStringTag',
        'WeakMap',
        'WeakSet'
    ].concat(
        typeof additionalFeatures === 'undefined' ? [] : additionalFeatures
    ))
_%>
<script src="https://polyfill.io/v3/polyfill.js?features=<%- encodeURIComponent(Array.from(features).sort().join(',')) %>"></script>
<script>
    /*
        Only provide the shadow dom polyfill and avoid to patch a lot
        of dom apis.
    */
    window.ShadyDOM = {noPatch: true}
</script>
<script src="/@webcomponents/webcomponentsjs/webcomponents-bundle.js"></script>
<!--TODO check if needed
    <script src="/@webcomponents/webcomponentsjs/custom-elements-es5-adapter.js"></script>
-->
